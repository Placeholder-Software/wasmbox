"use strict";(self.webpackChunkwasmbox_docs=self.webpackChunkwasmbox_docs||[]).push([[8637],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>f});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=c(a),d=r,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||o;return a?n.createElement(f,i(i({ref:t},u),{},{components:a})):n.createElement(f,i({ref:t},u))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(6010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,i),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>S});var n=a(7462),r=a(7294),o=a(6010),i=a(2466),l=a(6550),s=a(1980),c=a(7392),u=a(12);function m(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function p(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??m(a);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function d(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,s._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})}),[o,n])]}function b(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,o=p(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[s,c]=f({queryString:a,groupId:n}),[m,b]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,o]=(0,u.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:n}),h=(()=>{const e=s??m;return d({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{h&&l(h)}),[h]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),b(e)}),[c,b,o]),tabValues:o}}var h=a(2389);const y="tabList__CuJ",v="tabItem_LNqP";function k(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:m}=(0,i.o5)(),p=e=>{const t=e.currentTarget,a=u.indexOf(t),n=c[a].value;n!==l&&(m(t),s(n))},d=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const a=u.indexOf(e.currentTarget)+1;t=u[a]??u[0];break}case"ArrowLeft":{const a=u.indexOf(e.currentTarget)-1;t=u[a]??u[u.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":a},t)},c.map((e=>{let{value:t,label:a,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>u.push(e),onKeyDown:d,onClick:p},i,{className:(0,o.Z)("tabs__item",v,i?.className,{"tabs__item--active":l===t})}),a??t)})))}function w(e){let{lazy:t,children:a,selectedValue:n}=e;const o=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function g(e){const t=b(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",y)},r.createElement(k,(0,n.Z)({},e,t)),r.createElement(w,(0,n.Z)({},e,t)))}function S(e){const t=(0,h.Z)();return r.createElement(g,(0,n.Z)({key:String(t)},e))}},1940:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>m});var n=a(7462),r=(a(7294),a(3905)),o=a(4866),i=a(5162);const l={title:"WASI",sidebar_position:3},s=void 0,c={unversionedId:"basics/wasi/index",id:"basics/wasi/index",title:"WASI",description:"WASI, or WebAssembly System Interface, is an API specification that provides access to several operating-system-like features such as filesystems, clocks, and random numbers. Wasmbox provides implementations of most WASI functions (see Assets\\Plugins\\PlaceholderSoftware\\Wasmbox\\Core\\WASI\\).",source:"@site/docs/basics/wasi/index.md",sourceDirName:"basics/wasi",slug:"/basics/wasi/",permalink:"/wasmbox/basics/wasi/",draft:!1,editUrl:"https://github.com/Placeholder-Software/Wasmbox/tree/master/docs/basics/wasi/index.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"WASI",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Calling C# Code From WASM",permalink:"/wasmbox/basics/linker"},next:{title:"Virtual File System",permalink:"/wasmbox/basics/wasi/virtual_file_system"}},u={},m=[{value:"WASI Features",id:"wasi-features",level:2}],p={toc:m};function d(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"WASI, or ",(0,r.kt)("strong",{parentName:"p"},"WebAssembly System Interface"),", is an API specification that provides access to several operating-system-like features such as filesystems, clocks, and random numbers. Wasmbox provides implementations of most WASI functions (see ",(0,r.kt)("inlineCode",{parentName:"p"},"Assets\\Plugins\\PlaceholderSoftware\\Wasmbox\\Core\\WASI\\"),")."),(0,r.kt)("p",null,"WASI provides ",(0,r.kt)("em",{parentName:"p"},"controlled")," access to certain system resources. For example the virtual file system implemented by Wasmbox can provide in-memory files (which are never saved) as well as expose ",(0,r.kt)("em",{parentName:"p"},"parts")," of the real file system, allowing you to carefully control exactly what can and cannot be accessed through WASM code. These features can allow untrusted or malicious code to be run safely."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"WASM execution is normally completely ",(0,r.kt)("a",{parentName:"p",href:"/wasmbox/advanced/determinism"},"deterministic"),". Adding WASI features can easily break this, since it provides access to external resources which are not deterministic.")),(0,r.kt)("h2",{id:"wasi-features"},"WASI Features"),(0,r.kt)("p",null,"WASM Assets which require a WASI function will show a ",(0,r.kt)("inlineCode",{parentName:"p"},"WASI")," indicator next to the function. Hovering over the indicator will show which WASI feature is required to supply this import, clicking the indicator will bring you to this this documentation page. All WASI features are interfaces which you may implement yourself, or you can use one of the built in implementations."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"WASI Import",src:a(7408).Z,width:"724",height:"133"})),(0,r.kt)(o.Z,{queryString:"feature-name",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ivirtualrandomsource",label:"Random Numbers",mdxType:"TabItem"},(0,r.kt)("p",null,"Random number generation is provided by an implementation of ",(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/random"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualRandomSource")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"var rng = new CryptoRandomSource();\nlinker.Define(rng);\n"))),(0,r.kt)(i.Z,{value:"ivirtualprocess",label:"Process",mdxType:"TabItem"},(0,r.kt)("p",null,'Functions which would normally be associated with an OS "Process" are provided by an implementation of ',(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/process"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualProcess")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'var proc = new VirtualProcess(OnExit);\nlinker.Define(proc);\n\nvoid OnExit(uint code)\n{\n    Debug.Log("Process exited with code: " + code);\n}\n'))),(0,r.kt)(i.Z,{value:"ivirtualfilesystem",label:"File System",mdxType:"TabItem"},(0,r.kt)("p",null,"Functions which provide access to the filesystem are provided by an implementation of ",(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/filesystem"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualFileSystem")),'. The default implementation provides an entire "virtual filesystem" which can have a mix of real files/folders with fully virtual files/folders which are stored in memory.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'// Use a "VirtualFileSystemBuilder" to define a fake file system entirely in memory\nvar builder = new VirtualFileSystemBuilder()\n    .WithVirtualRoot(root => {\n        root.CreateVirtualDirectory("A")\n            .CreateVirtualDirectory("B", dir => {\n                dir.CreateInMemoryFile("File.txt");\n            })\n    });\n\nlinker.Define(builder.Build());\n'))),(0,r.kt)(i.Z,{value:"ivirtualenvironment",label:"Environment",mdxType:"TabItem"},(0,r.kt)("p",null,'Functions which would normally be associated with an OS "Environment" are provided by an implementation of ',(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/environment"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualEnvironment")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'var env = new VirtualEnvironment()\n    .PassthroughEnvironmentVariables()                      // Add all of the real environment variables\n    .SetEnvironmentVariable("foo", "bar")                   // Create a variable named "foo" with value "bar"\n    .SetArgs("--foo", "--bar", "bash", "-b", "-a", "-z"));  // Set the WASM process arguments\n\nlinker.Define(env);\n'))),(0,r.kt)(i.Z,{value:"ivirtualclock",label:"Clock",mdxType:"TabItem"},(0,r.kt)("p",null,"Functions which get the current system time are provided by an implementation of ",(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/clock"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualClock")),". A ",(0,r.kt)("inlineCode",{parentName:"p"},"RealtimeClock")," provides access to the real system time (with an optional offset). A ",(0,r.kt)("inlineCode",{parentName:"p"},"ManualClock")," provides access to a specific time which only advances when ",(0,r.kt)("inlineCode",{parentName:"p"},"clock.Tick()")," is called."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"var clock = new RealtimeClock();\nlinker.Define(clock);\n"))),(0,r.kt)(i.Z,{value:"ivirtualsocket",label:"Socket",mdxType:"TabItem"},(0,r.kt)("p",null,"Functions which interact with networking are provided by an implementation of ",(0,r.kt)("a",{parentName:"p",href:"/wasmbox/reference/code/WASI/socket"},(0,r.kt)("inlineCode",{parentName:"a"},"IVirtualSocket")),". Wasmbox does not currently implement socket functionality, ",(0,r.kt)("inlineCode",{parentName:"p"},"NonFunctionalSocket")," provides an implementation that does nothing. This can be used when using WASM files which requires the socket imports, but do not actually use them at runtime."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"var sock = new NonFunctionalSocket();\nlinker.Define(sock);\n"))),(0,r.kt)(i.Z,{value:"unknown",label:"Unknown Feature",mdxType:"TabItem"},(0,r.kt)("p",null,"Not all WASI functions are supported by the built in Wasmbox WASI features. Please contacts us on ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/3RtDa2M9Bx"},"Discord")," or on the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Placeholder-Software/wasmbox/issues"},"Issue Tracker")," about the specific feature you need."))),(0,r.kt)("hr",null))}d.isMDXComponent=!0},7408:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/InspectorWasi-36bbf1e78e5643310ae78ccd0fd95a9c.png"}}]);